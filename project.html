<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Project Tasks ‚Üí Calulator</title>

<style>
  :root{
    --bg:#ffffff;
    --surface:#ffffff;
    --surface2:#f8fafc;
    --text:#0f172a;
    --muted:#475569;
    --line:rgba(15,23,42,.14);
    --shadow: 0 10px 26px rgba(15,23,42,.10);
    --accent:#2563eb;
    --accent2:#059669;
    --danger:#dc2626;

    --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue", Helvetica, "Apple Color Emoji", "Segoe UI Emoji";
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  }

  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family:var(--sans);
    background: var(--bg);
    color: var(--text);
    padding: 22px;
  }

  .wrap{ max-width: 1200px; margin: 0 auto; }

  header{ margin-bottom: 14px; }
  h1{ margin:0; font-size:18px; letter-spacing:.2px; }
  .sub{
    margin: 6px 0 0 0;
    color: var(--muted);
    font-size: 13px;
    line-height: 1.35;
    max-width: 900px;
  }

  .card{
    background: var(--surface);
    border: 1px solid var(--line);
    border-radius: 14px;
    padding: 14px;
    box-shadow: var(--shadow);
  }

  .toolbar{
    display:flex;
    flex-wrap:wrap;
    gap: 12px;
    align-items:end;
    justify-content:space-between;
    margin: 10px 0 14px 0;
  }
  .left, .right{ display:flex; flex-wrap:wrap; gap: 10px; align-items:end; }

  label{
    font-size:12px;
    color: var(--muted);
    display:flex;
    flex-direction:column;
    gap:6px;
    min-width: 220px;
  }

  input[type="number"], input[type="text"], textarea{
    font: 13px var(--sans);
    padding: 9px 10px;
    border-radius: 10px;
    border: 1px solid var(--line);
    background: #ffffff;
    color: var(--text);
    outline:none;
  }
  input[type="number"]{ width: 140px; }
  input[type="text"]{ width: 100%; }
  textarea{ width:100%; min-height: 40px; resize: vertical; }

  .btn{
    border: 1px solid var(--line);
    background: #ffffff;
    color: var(--text);
    padding: 9px 12px;
    border-radius: 12px;
    cursor:pointer;
    font-size: 13px;
    transition: transform .05s ease, background .15s ease, border-color .15s ease;
    user-select:none;
    display:inline-flex;
    gap:8px;
    align-items:center;
    justify-content:center;
    white-space:nowrap;
  }
  .btn:hover{ background: #f8fafc; border-color: rgba(15,23,42,.22); }
  .btn:active{ transform: translateY(1px); }

  .btn.primary{
    background: rgba(37,99,235,.10);
    border-color: rgba(37,99,235,.35);
  }
  .btn.primary:hover{ background: rgba(37,99,235,.14); }

  .btn.good{
    background: rgba(5,150,105,.10);
    border-color: rgba(5,150,105,.35);
  }
  .btn.good:hover{ background: rgba(5,150,105,.14); }

  .btn.danger{
    background: rgba(220,38,38,.08);
    border-color: rgba(220,38,38,.35);
  }
  .btn.danger:hover{ background: rgba(220,38,38,.12); }

  .grid{
    width:100%;
    overflow:auto;
    border: 1px solid var(--line);
    border-radius: 12px;
  }
  table{
    width:100%;
    border-collapse:separate;
    border-spacing:0;
    min-width: 980px;
  }
  thead th{
    position:sticky;
    top:0;
    background: var(--surface2);
    border-bottom: 1px solid var(--line);
    font-size: 12px;
    color: var(--muted);
    text-align:left;
    padding: 10px;
    z-index: 1;
  }
  tbody td{
    border-bottom: 1px solid rgba(15,23,42,.06);
    padding: 10px;
    vertical-align: top;
  }
  tbody tr:hover td{ background: rgba(15,23,42,.02); }

  .col-task{ width:22%; min-width:220px; }
  .col-role{ width:14%; min-width:140px; }
  .col-hours{ width:120px; }
  .col-duration{ width:140px; color: var(--muted); font-size: 13px; white-space:nowrap; }
  .col-notes{ width:34%; min-width:280px; }
  .col-actions{ width:80px; text-align:right; white-space:nowrap; }

  .summary{
    display:flex;
    flex-wrap:wrap;
    gap: 10px;
    align-items:center;
    justify-content:space-between;
    margin-top: 14px;
    padding-top: 14px;
    border-top: 1px solid rgba(15,23,42,.10);
  }
  .pill{
    display:inline-flex;
    gap:8px;
    align-items:center;
    border: 1px solid rgba(15,23,42,.12);
    background: #ffffff;
    padding: 10px 12px;
    border-radius: 999px;
    font-size: 13px;
    color: var(--text);
  }
  .pill small{ color: var(--muted); font-size: 12px; }
  .pill b{ font-weight: 800; }

  .hint{
    font-size: 12px;
    color: var(--muted);
    margin-top: 8px;
    line-height: 1.45;
  }
  .kbd{
    font-family: var(--mono);
    font-size: 11px;
    padding: 2px 6px;
    border-radius: 6px;
    border: 1px solid rgba(15,23,42,.16);
    background: #ffffff;
    color: var(--text);
  }

  /* --- Bottom two panels: keep them fixed height; scroll inside --- */
/* --- Bottom two panels: fixed height, and allow BOTH columns to shrink --- */
.output{
  margin-top: 16px;
  display:grid;

  /* key change: minmax(0, ‚Ä¶) allows grid columns to shrink even with long code lines */
  grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);

  gap: 12px;
  align-items: stretch;
}

/* key change: min-width:0 lets the panel actually shrink inside a grid */
.output .card.panel{
  height: 520px;
  display:flex;
  flex-direction: column;
  min-width: 0;
}

  @media (max-width: 980px){
    .output{
      grid-template-columns: 1fr;
    }
    .output .card.panel{
      height: auto;
    }
    label{ min-width: 180px; }
  }

  .panel h2{
    margin:0 0 10px 0;
    font-size: 14px;
    letter-spacing: .2px;
  }
  .panel p{
    margin:0 0 10px 0;
    font-size: 12px;
    color: var(--muted);
    line-height: 1.45;
  }

  /* Make code box scroll inside panel */
pre{
  margin:0;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid var(--line);
  background: #0b1220;
  color: #e5e7eb;

  /* key: keep the long lines inside the box */
  overflow: auto;
  white-space: pre;

  font-family: var(--mono);
  font-size: 12px;
  line-height: 1.5;

  flex: 1;
  min-height: 0;
  min-width: 0;
}

  /* Make preview scroll inside panel */
.previewBox{
  border: 1px solid var(--line);
  border-radius: 12px;
  background: #fff;
  color: #111;

  overflow:auto;

  flex: 1;
  min-height: 0;
  min-width: 0;

  padding: 12px;
}

  .toast{
    position: fixed;
    bottom: 18px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(15,23,42,.92);
    border: 1px solid rgba(255,255,255,.14);
    color: #fff;
    padding: 10px 12px;
    border-radius: 999px;
    font-size: 13px;
    opacity: 0;
    pointer-events:none;
    transition: opacity .2s ease, transform .2s ease;
    box-shadow: 0 10px 25px rgba(15,23,42,.20);
  }
  .toast.show{
    opacity: 1;
    transform: translateX(-50%) translateY(-4px);
  }
</style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1>Project Tasks ‚Üí Calculator</h1>
     
    </header>

    <div class="card">
      <div class="toolbar">
        <div class="left">
          <label>
            Hours per day
            <input id="hoursPerDay" type="number" min="1" step="1" value="8" />
          </label>

          <label>
            Customer widget title (optional)
            <input id="widgetTitle" type="text" placeholder="e.g., Project Tasks and Notes" />
          </label>
        </div>

        <div class="right">
          <button class="btn" id="addRowBtn">‚ûï Add row</button>
          <button class="btn primary" id="loadAzureBtn">‚òÅÔ∏è Load Azure Migration (15)</button>
          <button class="btn danger" id="clearBtn">üßπ Clear</button>
        </div>
      </div>

      <div class="grid" aria-label="Tasks grid">
        <table>
          <thead>
            <tr>
              <th class="col-task">Task</th>
              <th class="col-role">Role</th>
              <th class="col-hours">Est. Hours</th>
              <th class="col-duration">Duration (internal)</th>
              <th class="col-notes">Notes</th>
              <th class="col-actions"></th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>

      <div class="summary">
        <div class="pill">
          <small>Total Hours (non-zero rows):</small>
          <b id="totalHours">0</b>
        </div>

        <div class="pill">
          <small>Rows included in widget:</small>
          <b id="includedCount">0</b>
        </div>

        <div class="right">
          <button class="btn good" id="generateBtn">üß© Generate TinyMCE HTML</button>
          <button class="btn" id="copyBtn" disabled>üìã Copy HTML</button>
        </div>
      </div>

      <div class="hint">
        Tip: paste the copied HTML into Salesbuildr‚Äôs editor. Use <span class="kbd">Tab</span> to move across fields quickly.
      </div>
    </div>

    <div class="output">
      <div class="card panel">
        <h2>Generated HTML (paste into TinyMCE)</h2>
        <p>Output only shows <b>Task</b>, <b>Role</b>, <b>Notes</b>, plus <b>Total Effort Hours</b>.</p>
        <pre id="htmlOut" aria-label="Generated HTML"></pre>
      </div>

      <div class="card panel">
        <h2>Preview</h2>
        <p>This is a rough preview. TinyMCE/Salesbuildr may apply its own typography.</p>
        <div class="previewBox" id="preview" aria-label="Widget preview"></div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // -----------------------------
    // Helpers / configuration
    // -----------------------------
    const STORAGE_KEY = "sb_task_widget_v2_light_azure";

    function showToast(msg){
      const el = document.getElementById("toast");
      el.textContent = msg;
      el.classList.add("show");
      setTimeout(() => el.classList.remove("show"), 1400);
    }

    function escapeHtml(str){
      return (str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function num(v){
      const n = Number(v);
      return Number.isFinite(n) ? n : 0;
    }

    // Always round UP to next 0.5 day, display "X days" or "X‚ÄìY days"
    function durationRange(hours, hoursPerDay){
      const h = num(hours);
      const hpd = Math.max(1, num(hoursPerDay));
      if (h <= 0) return "";

      const rawDays = h / hpd;
      const rounded = Math.ceil(rawDays * 2) / 2; // up to next half-day

      if (rounded % 1 === 0){
        return `${rounded} day${rounded === 1 ? "" : "s"}`;
      }
      const lower = Math.floor(rounded);
      const upper = lower + 1;
      return `${lower}\u2013${upper} days`;
    }

    function roundHoursDisplay(total){
      return Number.isInteger(total) ? String(total) : total.toFixed(1);
    }

    function defaultRow(){
      return { task:"", role:"", hours:"", notes:"" };
    }

    // -----------------------------
    // Template: Azure Migration (15 tasks)
    // Edit these defaults anytime.
    // -----------------------------
    function azureMigrationTemplate(){
      return [
        { task:"Project Kickoff & Planning", role:"PM", hours:"8", notes:"Scope confirmation, schedule, communication plan" },
        { task:"Azure Network Design & VPN Architecture", role:"Senior Engineer", hours:"8", notes:"Address space, subnets, gateway sizing" },
        { task:"Create/Configure Azure Virtual Network & VPN Gateway", role:"Senior Engineer", hours:"8", notes:"Includes site-to-site VPN to office(s)" },
        { task:"Create/Configure Azure Server VMs", role:"Engineer", hours:"48", notes:"VM provisioning, OS config, patching" },
        { task:"Security & Baseline Configuration", role:"Senior Engineer", hours:"24", notes:"NSGs, firewall rules, access controls" },
        { task:"Data Migration Planning & Validation", role:"Senior Engineer", hours:"24", notes:"Migration approach and test validation" },
        { task:"Migrate Data from On-Prem to Azure (standard servers)", role:"Engineer", hours:"48", notes:"File/data migration, integrity checks" },
        { task:"Migrate Data from On-Prem to Azure (vendor support)(optional)", role:"Senior Engineer", hours:"36", notes:"File/data migration, integrity checks from vendors" },
        { task:"Configure Workstations & Printers for New Network", role:"Engineer", hours:"24", notes:"DNS, mappings, printer updates (limited scope)" },
        { task:"Azure Virtual Desktop (AVD) Validation (if applicable)", role:"Senior Engineer", hours:"24", notes:"User access and performance validation" },
        { task:"User Acceptance & Environment Validation", role:"PM / Engineer", hours:"12", notes:"Confirmation Azure environment is working" },
        { task:"Decommission On-Prem VMs", role:"Engineer", hours:"12", notes:"Graceful shutdown, data verification" },
        { task:"Decommission On-Prem Hosts", role:"Engineer", hours:"4", notes:"Host retirement and cleanup" },
        { task:"Update Network & Process Documentation", role:"Engineer", hours:"8", notes:"Diagrams, runbooks, credentials handling" },
        { task:"Project Management (ongoing)", role:"PM", hours:"48", notes:"Status updates, coordination" }
      ];
    }

    // -----------------------------
    // State + persistence
    // -----------------------------
    let rows = [];

    function save(){
      const hoursPerDay = document.getElementById("hoursPerDay").value;
      const widgetTitle = document.getElementById("widgetTitle").value;
      localStorage.setItem(STORAGE_KEY, JSON.stringify({ hoursPerDay, widgetTitle, rows }));
    }

    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return false;
        const data = JSON.parse(raw);
        if (!data || !Array.isArray(data.rows)) return false;

        rows = data.rows;
        document.getElementById("hoursPerDay").value = data.hoursPerDay ?? 8;
        document.getElementById("widgetTitle").value = data.widgetTitle ?? "";
        return true;
      }catch{
        return false;
      }
    }

    // -----------------------------
    // Rendering
    // -----------------------------
    function render(){
      const tbody = document.getElementById("tbody");
      tbody.innerHTML = "";

      const hpd = document.getElementById("hoursPerDay").value;

      rows.forEach((r, idx) => {
        const tr = document.createElement("tr");

        // Task
        const tdTask = document.createElement("td");
        tdTask.className = "col-task";
        tdTask.innerHTML = `<input type="text" placeholder="e.g., Azure Network Design & VPN Architecture" value="${escapeHtml(r.task)}" />`;
        tdTask.querySelector("input").addEventListener("input", (e) => {
          rows[idx].task = e.target.value;
          save();
          autoRefreshOutputIfGenerated();
        });

        // Role
        const tdRole = document.createElement("td");
        tdRole.className = "col-role";
        tdRole.innerHTML = `<input type="text" placeholder="e.g., Engineer" value="${escapeHtml(r.role)}" />`;
        tdRole.querySelector("input").addEventListener("input", (e) => {
          rows[idx].role = e.target.value;
          save();
          autoRefreshOutputIfGenerated();
        });

        // Hours
        const tdHours = document.createElement("td");
        tdHours.className = "col-hours";
        tdHours.innerHTML = `<input type="number" min="0" step="0.5" placeholder="0" value="${escapeHtml(r.hours)}" />`;
        tdHours.querySelector("input").addEventListener("input", (e) => {
          rows[idx].hours = e.target.value;
          updateTotalsAndDurations();
          save();
          autoRefreshOutputIfGenerated();
        });

        // Duration (internal)
        const tdDur = document.createElement("td");
        tdDur.className = "col-duration";
        tdDur.textContent = durationRange(r.hours, hpd);

        // Notes
        const tdNotes = document.createElement("td");
        tdNotes.className = "col-notes";
        tdNotes.innerHTML = `<textarea placeholder="Notes shown to customer...">${escapeHtml(r.notes)}</textarea>`;
        tdNotes.querySelector("textarea").addEventListener("input", (e) => {
          rows[idx].notes = e.target.value;
          save();
          autoRefreshOutputIfGenerated();
        });

        // Actions
        const tdActions = document.createElement("td");
        tdActions.className = "col-actions";
        const delBtn = document.createElement("button");
        delBtn.className = "btn danger";
        delBtn.textContent = "üóëÔ∏è";
        delBtn.title = "Delete row";
        delBtn.addEventListener("click", () => {
          rows.splice(idx, 1);
          render();
          updateTotalsAndDurations();
          save();
          autoRefreshOutputIfGenerated();
        });
        tdActions.appendChild(delBtn);

        tr.appendChild(tdTask);
        tr.appendChild(tdRole);
        tr.appendChild(tdHours);
        tr.appendChild(tdDur);
        tr.appendChild(tdNotes);
        tr.appendChild(tdActions);

        tbody.appendChild(tr);
      });

      updateTotalsAndDurations();
    }

    function updateTotalsAndDurations(){
      const hpd = document.getElementById("hoursPerDay").value;

      // Update duration cells
      const tbody = document.getElementById("tbody");
      Array.from(tbody.querySelectorAll("tr")).forEach((tr, idx) => {
        const durCell = tr.querySelector(".col-duration");
        if (durCell) durCell.textContent = durationRange(rows[idx]?.hours, hpd);
      });

      // Totals / included rows (non-zero)
      let total = 0;
      let included = 0;
      rows.forEach(r => {
        const h = num(r.hours);
        if (h > 0){
          total += h;
          included += 1;
        }
      });

      document.getElementById("totalHours").textContent = roundHoursDisplay(total);
      document.getElementById("includedCount").textContent = included;
    }

    // -----------------------------
    // Widget HTML generation (customer-facing)
    // -----------------------------
    function generateWidgetHTML(){
      const title = (document.getElementById("widgetTitle").value || "").trim();
      const hpd = document.getElementById("hoursPerDay").value;

      const includedRows = rows
        .map(r => ({
          task: (r.task || "").trim(),
          role: (r.role || "").trim(),
          notes: (r.notes || "").trim(),
          hours: num(r.hours),
          _duration: durationRange(r.hours, hpd) // internal only
        }))
        .filter(r => r.hours > 0 && (r.task || r.role || r.notes)); // omit 0 and empty

      const totalHours = includedRows.reduce((sum, r) => sum + r.hours, 0);

      const safeTitle = escapeHtml(title);
      const totalLabel = `Total Effort Hours: <strong>${escapeHtml(roundHoursDisplay(totalHours))}</strong>`;

      const tableRowsHtml = includedRows.map(r => `
<tr>
  <td style="padding:8px 10px;border:1px solid #e6e6e6;vertical-align:top;"><strong>${escapeHtml(r.task)}</strong></td>
  <td style="padding:8px 10px;border:1px solid #e6e6e6;vertical-align:top;white-space:nowrap;">${escapeHtml(r.role)}</td>
  <td style="padding:8px 10px;border:1px solid #e6e6e6;vertical-align:top;">${escapeHtml(r.notes)}</td>
</tr>`.trim()).join("\n");

      const widgetHtml = `
<div style="font-family: Arial, Helvetica, sans-serif;">
  ${safeTitle ? `<h3 style="margin:0 0 10px 0;font-size:18px;">${safeTitle}</h3>` : ``}
  <table style="width:100%;border-collapse:collapse;font-size:14px;">
    <thead>
      <tr>
        <th style="text-align:left;padding:8px 10px;border:1px solid #e6e6e6;background:#f7f7f7;">Task</th>
        <th style="text-align:left;padding:8px 10px;border:1px solid #e6e6e6;background:#f7f7f7;">Role</th>
        <th style="text-align:left;padding:8px 10px;border:1px solid #e6e6e6;background:#f7f7f7;">Notes</th>
      </tr>
    </thead>
    <tbody>
      ${tableRowsHtml || `
<tr>
  <td colspan="3" style="padding:10px;border:1px solid #e6e6e6;color:#666;">No tasks with hours &gt; 0.</td>
</tr>`.trim()}
    </tbody>
  </table>
  <p style="margin:10px 0 0 0;font-size:14px;">${totalLabel}</p>
</div>`.trim();

      return widgetHtml;
    }

    function autoRefreshOutputIfGenerated(){
      // If user has already generated once, keep it in sync as they edit.
      const htmlOut = document.getElementById("htmlOut");
      if (htmlOut.textContent.trim()){
        const html = generateWidgetHTML();
        htmlOut.textContent = html;
        document.getElementById("preview").innerHTML = html;
      }
    }

    // -----------------------------
    // Button handlers
    // -----------------------------
    document.getElementById("addRowBtn").addEventListener("click", () => {
      rows.push(defaultRow());
      render();
      save();
    });

    document.getElementById("loadAzureBtn").addEventListener("click", () => {
      rows = azureMigrationTemplate();
      const titleEl = document.getElementById("widgetTitle");
      if (!titleEl.value.trim()){
        titleEl.value = "Project Tasks and Notes";
      }
      // Clear prior output so it doesn't look mismatched; user can click Generate (or just edit then Generate)
      document.getElementById("htmlOut").textContent = "";
      document.getElementById("preview").innerHTML = "";
      document.getElementById("copyBtn").disabled = true;

      render();
      save();
      showToast("Loaded Azure Migration (15)");
    });

    document.getElementById("clearBtn").addEventListener("click", () => {
      if (!confirm("Clear all rows?")) return;
      rows = [ defaultRow() ];
      document.getElementById("htmlOut").textContent = "";
      document.getElementById("preview").innerHTML = "";
      document.getElementById("copyBtn").disabled = true;
      render();
      save();
      showToast("Cleared");
    });

    document.getElementById("hoursPerDay").addEventListener("input", () => {
      updateTotalsAndDurations();
      save();
      autoRefreshOutputIfGenerated();
    });

    document.getElementById("widgetTitle").addEventListener("input", () => {
      save();
      autoRefreshOutputIfGenerated();
    });

    document.getElementById("generateBtn").addEventListener("click", () => {
      const html = generateWidgetHTML();
      document.getElementById("htmlOut").textContent = html;
      document.getElementById("preview").innerHTML = html;
      document.getElementById("copyBtn").disabled = false;
      showToast("HTML generated");
      save();
    });

    document.getElementById("copyBtn").addEventListener("click", async () => {
      const html = document.getElementById("htmlOut").textContent;
      if (!html.trim()) return;

      try{
        await navigator.clipboard.writeText(html);
        showToast("Copied to clipboard");
      }catch{
        // Fallback copy
        const ta = document.createElement("textarea");
        ta.value = html;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        showToast("Copied (fallback)");
      }
    });

    // -----------------------------
    // Init
    // -----------------------------
    (function init(){
      const hasSaved = load();
      if (!hasSaved){
        // Start with the full Azure list by default (since that's your repeatable workflow)
        rows = azureMigrationTemplate();
        document.getElementById("widgetTitle").value = "Project Tasks and Notes";
      }
      render();
    })();
  </script>
</body>
</html>
